// Generated by CoffeeScript 2.5.1
(function() {
  var request, sync;

  request = require("request");

  sync = require("sync-request");

  exports.get_client_credentials = function(authorization, callback) {
    var authOptions;
    authOptions = {
      url: 'https://accounts.spotify.com/api/token',
      headers: {
        "Authorization": `Basic ${authorization}`
      },
      form: {
        grant_type: "client_credentials"
      },
      json: true
    };
    return request.post(authOptions, function(error, response, body) {
      return callback(body.access_token);
    });
  };

  exports.get_main_user = function(token) {
    return JSON.parse(sync("GET", "https://api.spotify.com/v1/me/", {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    }).getBody("utf8"));
  };

  exports.create_playlist = function(name, token, pblc = true, collaborative = false, description = "Made using Mikedrop") {
    var headers, json, user_id;
    user_id = exports.get_main_user(token).id;
    headers = {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    };
    json = {
      "name": escape(name),
      "public": pblc,
      "collaborative": collaborative,
      "description": escape(description)
    };
    return JSON.parse(sync("POST", `https://api.spotify.com/v1/users/${user_id}/playlists`, {headers, json}).getBody("utf8"));
  };

  exports.add_playlist_tracks = function(playlist, tracks, token) {
    var headers, json, track;
    headers = {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    };
    json = {
      "uris": (function() {
        var i, len, results;
        results = [];
        for (i = 0, len = tracks.length; i < len; i++) {
          track = tracks[i];
          results.push(track.uri);
        }
        return results;
      })()
    };
    return JSON.parse(sync("POST", `https://api.spotify.com/v1/playlists/${playlist.id}/tracks`, {headers, json}).getBody("utf8"));
  };

  exports.get_playlist_tracks = function(playlist, token, limit = 25, offset = 0) {
    return JSON.parse(sync("GET", `https://api.spotify.com/v1/playlists/${playlist.id}/tracks?limit=${limit}&offset=${offset}`, {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    }).getBody("utf8")).items;
  };

  exports.get_by_id = function(id, obj_type, token) {
    return JSON.parse(sync("GET", `https://api.spotify.com/v1/${obj_type}/${id}`, {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    }).getBody("utf8"));
  };

  exports.search = function(query, search_type, token, limit = 5, offset = 0) {
    return JSON.parse(sync("GET", `https://api.spotify.com/v1/search?q=${escape(query.replace(/[^\x00-\x7F]/g, ''))}&type=${search_type}&limit=${limit}&offset=${offset}`, {
      headers: {
        "Authorization": `Bearer ${token}`
      }
    }).getBody("utf8"))[`${search_type}s`].items;
  };

  exports.search_playlists = function(query, token, limit = 5, offset = 0) {
    return exports.search(query, "playlist", token, limit, offset);
  };

  exports.search_tracks = function(query, token, limit = 5, offset = 0) {
    return exports.search(query, "track", token, limit, offset);
  };

}).call(this);
